pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // Pull the latest code from GitHub
                git url: 'https://github.com/WaseemHajwane/dot-net.git', branch: 'main'
            }
        }
        stage('Restore') {
            steps {
                // Restore .NET dependencies
                bat 'dotnet restore'
            }
        }
        stage('Build') {
            steps {
                // Build the project
                bat 'dotnet build --configuration Release'
            }
        }
        stage('Test') {
            steps {
                // Run tests
                bat 'dotnet test'
            }
        }
        stage('Publish') {
            steps {
                // Publish the application
                bat 'dotnet publish --configuration Release --output "D:\\publish-output"'
            }
        }
        stage('Deploy to IIS') {
            steps {
                // Stop IIS
                bat 'iisreset /stop'

                // Copy published files to IIS directory
                bat '''
                xcopy "D:\\publish-output" "D:\\demonetproject\\testproject\\bin\\release\\net8.0\\publish" /E /H /C /I /Y
                '''

                // Restart IIS
                bat 'iisreset /start'
            }
        }
    }
}
